# vim: set ft=ruby:

cache.platform = TSC::Platform.current.name
cache.os = TSC::Platform.current.driver

product {
  name 'SK'
  description 'Stemkit'

  top '/usr/local/stemkit'
  version '0.0.1'

  case cache.platform
    when 'cygwin-xp-x86'
      user 'Guest'
      group 'Guests'
    else
      user 'root'
      group 'bin'
  end

  package {
    name 'cpp'
    description 'C++ ojbect libraries'

    tasks %w{
      system-query-top
      system-create-files
      system-set-permissions
      system-set-user-group
    }
    filesets %w{
      main util sys io cppunit
    }
  }
}

fileset {
  name "main"

  directory %w{
    bin
  }
  generate.as('bin/stemkit-info').source {
    program 'install/make-info.rb'
  }
}

fileset {
  name 'util'

  directory %w{
    include/sk/util
    lib
  }
  install.into('include/sk/util').source {
    file 'include/sk/util' => %w{
      inspect.h
      Object.h
      Class.h
      Integer.h
      String.h
      StringArray.h
      Container.h
      Slot.h
      ReferenceSlot.hxx
      ReferenceSlot.cxx
      PointerSlot.hxx
      PointerSlot.cxx
      Holder.hxx
      Holder.cxx
      Selector.h
      Processor.h
      Collection.h
      List.h
      AbstractCollection.hxx
      AbstractCollection.cxx
      AbstractList.hxx
      AbstractList.cxx
      ArrayList.hxx
      ArrayList.cxx
      abstract_c_handle.hxx
      abstract_c_handle.cxx
    }
  }

  install.into('include/sk/util').source {
    file 'include/sk/util' => %w{
      Exception.h
      IllegalStateException.h
      IndexOutOfBoundsException.h
      InterruptedException.h
      MissingResourceException.h
      NoSuchElementException.h
      NullPointerException.h
      NumberFormatException.h
      SystemException.h
      UnsupportedOperationException.h
      InsufficientMemoryException.h
    }
  }
  install.into('lib').binary {
    list = %w{
      sk.util
    }
    if ENV['MAKE_DLL'] == 'true'
      library 'lib' => list
    else
      static_library 'lib' => list
    end
  }
}

fileset {
  name 'io'

  directory %w{
    include/sk/io
    lib
  }
  install.into('include/sk/io').source {
    file 'include/sk/io' => %w{
      AbstractInputStream.h
      AbstractOutputStream.h
      ByteArrayInputStream.h
      ByteArrayOutputStream.h
      DataInput.h
      DataInputStream.h
      DataOutput.h
      DataOutputStream.h
      DelegatingInputStream.h
      DelegatingOutputStream.h
      File.h
      Pipe.h
      Tty.h
      TtyDevice.h
      DelegatingTty.h
      Pty.h
      TtyFileDescriptor.h
      FileDescriptor.h
      FileDescriptorInputStream.h
      FileDescriptorOutputStream.h
      FileStreamCoupler.hxx
      FileStreamCoupler.cxx
      FileInputStream.h
      FileOutputStream.h
      BufferedInputStream.h
      BufferedOutputStream.h
      InputStream.h
      OutputStream.h
      IOException.h
      EOFException.h
      ClosedChannelException.h
    }
  }

  install.into('lib').binary {
    list = %w{
      sk.io
    }
    if ENV['MAKE_DLL'] == 'true'
      library 'lib' => list
    else
      static_library 'lib' => list
    end
  }
}

fileset {
  name 'sys'

  directory %w{
    include/sk/sys
    lib
  }
  install.into('include/sk/sys').source {
    file 'include/sk/sys' => %w{
      DelegatingExecutable.h
      Executable.h
      PipeProcess.h
      PtyProcess.h
      Pipeline.h
      Process.h
      ProcessListener.h
      User.h
      Group.h
    }
  }

  install.into('lib').binary {
    list = %w{
      sk.sys
    }
    if ENV['MAKE_DLL'] == 'true'
      library 'lib' => list
    else
      static_library 'lib' => list
    end
  }
}

fileset {
  name 'cppunit'

  directory %w{
    include/sk/cppunit
    lib
  }
  install.into('include/sk/cppunit').source {
    file 'include/sk/cppunit' => %w{
      SingleLineOutputter.h
      TestRunner.h
    }
  }
  install.into('lib').binary {
    list = %w{
      sk.cppunit
    }
    if ENV['MAKE_DLL'] == 'true'
      library 'lib' => list
    else
      static_library 'lib' => list
    end
  }
}

